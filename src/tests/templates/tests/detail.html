{% extends "base_no_navigation.html" %}
{% block content %}
{# Add these meta tags in the head #}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<script>
// Add this at the top of your script section
window.onpageshow = function(event) {
    if (event.persisted) {
        window.location.reload();
    }
};

// Prevent going back
window.history.forward();
function noBack() {
    window.history.forward();
}
</script>

{# Add this to your body tag #}
<body onload="noBack();" onpageshow="if (event.persisted) noBack();" onunload="">

<div class="w-full mx-auto md:w-4/6 mt-10">
	<h3>{{test.title}}</h3>
	<h5 class="block font-sans text-xl antialiased leading-snug tracking-normal text-blue-gray-900">Zbývající počet pokusů: {{test_attempts}} z {{test.attempts}}</h5>
</div>

<form
	id="test-form"
	action="{% url 'tests:validate_test' course=course test_id=test.id %}"
	method="post"
	class="w-full border border-gray-200 rounded-lg shadow mx-auto md:w-4/6 mt-10 p-6">
	{% csrf_token %}
	{% for field in testForm %}
		<div class="mt-3 parent_label task-description">
			{{ field.label }}
		</div>
		<div class="mt-3 parent_label">
			{{ field }}
		</div>
		<br>
		<hr>
	{% endfor %}
	<div class="mt-4 parent_label h-10">
		<input
			type="submit"
			onclick="return confirmAction()"
			value="Odevzdat"
			class="float-right text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 focus:outline-none">
	</div>

</form>

<style>
	.task-description {
		white-space: pre-line;
		line-height: 1.6;
	}
	.task-description .command {
		background-color: #f3f4f6;
		padding: 0.2em 0.4em;
		border-radius: 0.25rem;
		font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
		font-size: 0.875em;
	}
</style>
<script>

document.addEventListener('DOMContentLoaded', () => {
		const taskElements = document.querySelectorAll('.task-description');
		if (!taskElements.length) return;

		taskElements.forEach(taskElement => {
			const text = taskElement.textContent || '';
			const formattedText = text
				.split('\n')
				.map(line => {
					return line.replace(/`([^`]+)`/g, '<span class="command">$1</span>');
				})
				.join('<br>');

			taskElement.innerHTML = formattedText;
		});
	});

function confirmAction() {
	var result = confirm("Skutečně si přeješ odevdat tento test?");

	if (result) {
		return true;
	} else {
		return false;
	}
}
</script>
{% endblock %}

</body>
</html>
